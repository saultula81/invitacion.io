<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Metadatos para vista previa en redes sociales (WhatsApp, etc.) -->
    <meta property="og:title" content="¡Tienes una Invitación Especial!" />
    <meta
      property="og:description"
      content="Haz clic en el sello para abrir el sobre y descubrir los detalles."
    />
    <!-- NOTA: Para que la imagen funcione en WhatsApp, la invitación debe estar en un servidor y esta URL debe ser completa (ej: https://tusitio.com/sello.png) -->
    <meta property="og:image" content="sello.png" />
    <meta property="og:type" content="website" />

    <!-- Librería para el efecto de confeti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

    <title>¡Tienes una Invitación!</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background-color: #f4f4f9; /* Color de fondo por defecto */
        padding: 20px;
        overflow: hidden; /* Evita scroll si el sobre es más grande */
      }

      /* Capa para la imagen de fondo difuminada */
      body::before {
        content: "";
        position: fixed;
        top: -10px;
        left: -10px;
        right: -10px;
        bottom: -10px;
        background-size: cover;
        background-image: var(--bg-image);
        filter: blur(5px) brightness(0.9); /* Desenfoque y ligero oscurecimiento */
        z-index: -1; /* Detrás de todo el contenido */
      }

      /* Estilos para el contenedor principal que centra todo */
      .container {
        position: relative;
        perspective: 1000px; /* Para efectos 3D si quisiéramos en el futuro */
      }

      /* Estilos del sobre */
      .envelope {
        width: 90vw; /* 90% del ancho de la pantalla */
        max-width: 675px; /* Mantenemos el tamaño máximo para pantallas grandes */
        aspect-ratio: 675 / 444; /* Mantiene la proporción del sobre */
        background-image: url("sobre.png");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        border-radius: 10px;
        transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
        position: absolute; /* Para que la tarjeta se muestre "encima" o "detrás" */
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2; /* Asegura que el sobre esté encima de la tarjeta */
      }

      /* Animación para cuando el sobre se abre y desaparece */
      .envelope.opened {
        transform: translate(-50%, -50%) scale(0.9); /* Se encoge un poco */
        opacity: 0;
        pointer-events: none;
      }

      /* Estilos para la imagen del sello */
      .seal-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 22%; /* Tamaño del sello relativo al sobre */
        aspect-ratio: 1 / 1; /* Sello perfectamente cuadrado */
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: transform 0.3s ease;
        z-index: 3; /* Encima del sobre */
        animation: sealPulse 2s infinite ease-in-out;
      }

      .seal-image {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      .seal-text {
        position: relative; /* Para que esté sobre la imagen */
        color: white;
        font-weight: bold;
        font-size: 1.8vw; /* Tamaño de fuente adaptable */
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        text-align: center;
      }

      @keyframes sealPulse {
        0% {
          transform: translate(-50%, -50%) scale(1.05);
        }
        50% {
          transform: translate(-50%, -50%) scale(1.1);
        }
        100% {
          transform: translate(-50%, -50%) scale(1.05);
        }
      }

      /* Animación de zoom sutil para la imagen de la tarjeta */
      @keyframes zoom-in-out {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.03); /* Un zoom muy sutil */
        }
        100% {
          transform: scale(1);
        }
      }

      /* Estilos de la tarjeta (inicialmente oculta) */
      .invitation-card {
        background: linear-gradient(135deg, #ffffff, #f0f0f0);
        border-radius: 20px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        padding: 0; /* Sin padding para que la imagen ocupe todo el espacio */
        max-width: 450px; /* Ancho máximo para la tarjeta */
        width: 90vw; /* Ancho adaptable a la pantalla */
        aspect-ratio: 586 / 829; /* Proporción de la imagen tarj.png */
        border: none; /* Quitamos el borde de color */
        opacity: 0;
        transform: scale(0.8); /* Empieza más pequeña */
        transition: opacity 1s ease-out 0.3s, transform 1s ease-out 0.3s; /* Añadimos un retraso */
        z-index: 1; /* Para que esté "detrás" del sobre inicialmente */
        position: relative;
        overflow: hidden; /* Asegura que la imagen no se salga de los bordes redondeados */
        pointer-events: none; /* No se puede interactuar cuando está oculta */
      }

      .invitation-card.visible {
        opacity: 1;
        transform: scale(1); /* Crece a su tamaño normal */
        pointer-events: auto; /* Se puede interactuar cuando es visible */
      }

      .invitation-image {
        width: 100%;
        height: 100%;
        border-radius: 20px; /* Mantenemos las esquinas redondeadas */
        display: block;
        animation: zoom-in-out 10s ease-in-out infinite; /* Aplicamos la animación */
        animation-play-state: paused; /* La animación empieza pausada */
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="envelope" id="envelope">
        <div class="seal-container" id="seal">
          <img src="sello.png" alt="Sello de cera" class="seal-image" />
          <span class="seal-text">CLICK<br />AQUÍ</span>
        </div>
      </div>

      <div class="invitation-card" id="invitationCard">
        <!-- La imagen de la invitación reemplaza todo el contenido anterior -->
        <img src="tarj.png" alt="Invitación" class="invitation-image" />
        <audio id="background-music" loop></audio>
      </div>
    </div>

    <script>
      // Obtenemos referencias a los elementos del DOM
      const envelope = document.getElementById("envelope");
      const seal = document.getElementById("seal");
      const invitationCard = document.getElementById("invitationCard");
      const invitationImage = document.querySelector(".invitation-image");

      // Añadimos un "escuchador de eventos" para el clic en el sello
      seal.addEventListener("click", () => {
        // Cuando se hace clic, ocultamos el sobre y mostramos la tarjeta
        envelope.classList.add("opened"); // El sobre se "abre" y desaparece
        invitationCard.classList.add("visible"); // La tarjeta aparece

        // Iniciamos la animación de la imagen cuando la tarjeta es visible
        invitationImage.style.animationPlayState = "running";

        // --- Iniciar la música ---
        const music = document.getElementById("background-music");
        if (music.src && music.paused) {
          music
            .play()
            .catch((e) =>
              console.error(
                "La reproducción automática fue bloqueada por el navegador.",
                e
              )
            );
        }

        // --- Lanzar confeti ---
        // Disparamos un poco de confeti desde los lados
        const duration = 3 * 1000; // 3 segundos de confeti
        const end = Date.now() + duration;

        (function frame() {
          // Lanzar desde la izquierda
          confetti({
            particleCount: 2,
            angle: 60,
            spread: 55,
            origin: { x: 0 },
          });
          // Lanzar desde la derecha
          confetti({
            particleCount: 2,
            angle: 120,
            spread: 55,
            origin: { x: 1 },
          });

          if (Date.now() < end) {
            requestAnimationFrame(frame);
          }
        })();
      });

      // --- Lógica para actualizar enlaces y fondo (se ejecuta al cargar la página generada) ---
      window.addEventListener("load", () => {
        // El número de teléfono y la URL del fondo se insertarán como atributos de datos
        const bgUrl = document.body.dataset.bgUrl;
        const musicUrl = document.body.dataset.musicUrl;

        // Asignar imagen de fondo si existe
        if (bgUrl) {
          document.body.style.setProperty("--bg-image", `url(${bgUrl})`);
        }

        // Asignar música de fondo si existe
        if (musicUrl) {
          const musicElement = document.getElementById("background-music");
          musicElement.src = musicUrl;
        }
      });
    </script>
  </body>
</html>
